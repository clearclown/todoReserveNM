# CODING_RULES

**このドキュメントではReServeのコーディングルールを定義する。**

## 目的 : 拡張性・可読性・セキュリティを高い水準で保つこと。

### 命名規則
- ローカル変数/関数名はロウワーキャメルケース (例 : getUserStatus)
- パブリック変数/関数名はアッパーキャメルケース (例 : GetUserStatus)

### コーディングについて
#### 共通
- ESLintの設定に従う
- Prettierの設定に従う
- コメントは日本語で記述可
- 関数やクラスには適切なJSDocを記述
- 環境変数は`.env`ファイルで管理し、`.env.example`にサンプルを提供
- 秘密情報やキーは`.env`ファイルのみに記載し、リポジトリにコミットしない
- 新規コードは必ずTypeScriptを用いて静的解析を受ける。
- 拡張性を考慮してモジュール化を徹底する。
- DRY原則、スパゲティプログラム禁止の原則を守り、重複コードを避ける。
- 関数は単一責任とし、役割を明確にする。
- 変数名・関数名は意味のある英語を使用する。
- コメントを多くし、コード自体が意図を伝えるようにする。
- `ChangeLOG.md`やドキュメントを更新し、使用方法を共有する。
- アプリケーションの秘密情報は環境変数で管理する。
- 例外処理を忘れず、予期せぬエラーにも備える。
- 監査ログを取得し、操作履歴を追跡可能にする。
- 常に最新のセキュリティ勧告を確認し更新を怠らない。

##### イポート順序
1. ノードモジュール (React, Nestjs など)
2. サードパーティライブラリ (Tanstack, shadcn/ui など)
3. 自作モジュール (相対パス)
4. 型定義
5. スタイル

##### コード分割ルール
- 1ファイルにつき最大100行程度を目安に
- 1関数につき最大50行程度を目安に
- 複雑なロジックは適切に分割し、関心ごとに分離する
- UIとロジックの分離 (Container-Presentational パターン推奨)

#### バックエンド
- NestJSの標準構造を踏襲し、モジュール単位で責務を分離。
- 各コントローラはデータ検証を行うDTOを利用する。
- SQLインジェクション対策としてORMやパラメータバインドを使用。
- 入力値は型チェックとサニタイズを必ず行う。
- 外部から渡る文字列は必要に応じてエスケープ処理を行う。
- XSS対策としてテンプレートレンダリング時はescaping関数を使う。
- DDoS対策としてリクエストレート制限を導入する。
- 認証はJWTやセッション管理を組み合わせて実装する。
- パスワードはargon2id等の強力なハッシュで保存する。
- APIのレスポンスには不要な情報を含めない。
- ログに個人情報を出力しない。
- 例外メッセージに内部情報を出さない。
- 定期的に依存ライブラリの脆弱性をスキャンする。
- 不要なポート・サービスは開放しない。
- 環境毎に適切な設定ファイルを用意し、開発用設定を本番に持ち込まない。
- 外部APIとの通信にはタイムアウトを設定する。
- ルーティングは明示的に定義し、ワイルドカードを避ける。
- コントローラでの例外はフィルタやミドルウェアで統一して処理する。
- マイクロサービス化する際は共通のインタフェースを設計する。
- プロジェクトルート以外のファイルは直接配信しない。
- PrismaなどのORMはSQLログを確認できるよう設定する。
- セキュリティヘッダーを追加するミドルウェアを利用する。
- CORS設定は必要最小限のドメインに限定する。
- ファイルアップロードのサイズ制限を設ける。
- エラーハンドリングのテストケースを用意する。
- サーバ起動時に設定値を検証し、欠落していれば起動しない。
- 自動化された単体テストと統合テストをCIに組み込む。
- APIのバージョン管理を行い、互換性を保つ。
- 依存性注入を徹底しテストしやすい構造とする。
- アクセスログとエラーログは分けて収集する。
- バックエンドの単体テストをvitestで自動化する。

#### フロントエンド
- Reactコンポーネントは関数コンポーネントで記述する。
- 型安全のためPropsとStateは明示的に定義する。
- XSS対策としてdangerouslySetInnerHTMLの使用を避ける。
- 外部APIとの通信はaxios等のラッパーを通して行う。
- ユーザ入力を表示する際はエスケープ処理を行う。
- グローバル状態管理はJotai等で必要最小限に。
- コンポーネントの再利用を意識し、ファイルを小さく保つ。
- スタイルはCSS Modulesなどスコープ化された方法を用いる。
- フォーム入力はバリデーションルールを明示的に指定する。
- ルーティング定義は単一ファイルに集約して変更しやすく。
- アクセシビリティを考慮し適切なセマンティックタグを使う。
- ビルド成果物にはソースマップを含めず、公開範囲を限定。
- フロントエンドの単体テストをvitestで自動化する。

これらのルールに従ってプロジェクトを構成することで、一貫性のある保守しやすいコードベースを維持できる。
**絶対に厳守**し、従ってほしい。
なお、質問がある場合やupdateが必要な場合は適宜、その旨を申し出てほしい。
